<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Solution Pattern: Name Template :: Solution Patterns for Cloud Native Architectures</title>
    <link rel="canonical" href="https://redhat-solution-patterns.github.io/solution-patterns/solution-pattern-template/02-architecture.html">
    <link rel="prev" href="index.html">
    <link rel="next" href="03-solutions.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" style="font-size: 20px; color: white"
        href="https://redhat-solution-patterns.github.io/solution-patterns">
        <img src="../_/img/logo.png" height="35px" alt="Solution Patterns">&nbsp; Solution Patterns for Cloud Native Architectures</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Architectures &amp; Patterns</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://www.redhat.com/architect/portfolio/" target="_blank">Portfolio Architecture&nbsp; </a>
            <a class="navbar-item" href="https://redhat-solution-patterns.github.io/solution-patterns/patterns.html"  target="_blank">Solution Patterns </a>
            <a class="navbar-item" href="https://validatedpatterns.io/" target="_blank">Validated Patterns&nbsp;</a>
            <a class="navbar-item" href="https://catalog.redhat.com/solutions" target="_blank">Ecosystem Solutions&nbsp;</a>
          </div>
        </div>

        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" target="_blank" href="https://developers.redhat.com">Red Hat Developers</a>
            <a class="navbar-item" target="_blank" href="https://developers.redhat.com/app-dev-platform">App Dev Platform</a>
            <a class="navbar-item" target="_blank" href="https://www.redhat.com/en/products/application-foundations">Red Hat Application Services</a>
          </div>
        </div>

          <a class="navbar-item" target="_blank" href="https://github.com/redhat-solution-patterns/redhat-solution-patterns.github.io/issues">Feedback</a>
          <a class="navbar-item" target="_blank" href="https://redhat-solution-patterns.github.io/solution-patterns/contributors-guide.html">Contribute</a>

      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="solution-pattern-template" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">Openshift Serverless for AI/ML</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">1. Home page</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#why-serverless">1.1 Why Serverless for AI/ML</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#use-cases">1.2 Use cases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_the_story_behind_this_solution_pattern">1.3 The story behind this solution pattern</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_the_solution">1.4 The solution</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-architecture.html">2. OpenShift Serverless Architecture</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#_knative_components">2.1. Serverless components</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#_knative_serving">2.2. Knative Serving</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#_knative_eventing">2.3. Knative Eventing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-solutions.html">3. See the Solutions in Action</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04-workshop.html">3.1 Serverless Bookstore Lab</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-workshop.html#_what_are_we_building">3.1.1. About the workshop</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-01-setup.html#_environment_setup">3.1.2. Environment Setup</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-02-workshop.html#_send_review_comment_to_broker">3.2.3. Send comments to broker</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="05-prod-setup.html">4. Configuring OpenShift Serverless for Production</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="developer-resources.html">5. Developer Resources</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="developer-resources.html#_resources">5.1 Resources</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="developer-resources.html#interactive-demos">5.2 Interactive Demos</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="developer-resources.html#demos">5.3 Demo Recordings</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="https://redhat-solution-patterns.github.io/solution-patterns/patterns.html" target="_blank" rel="noopener">Explore Red Hat Solution Patterns</a></span>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Openshift Serverless for AI/ML</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Openshift Serverless for AI/ML</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Openshift Serverless for AI/ML</a></li>
    <li><a href="02-architecture.html">2. OpenShift Serverless Architecture</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/ortwinschneider/solution-pattern-serverless-ai/edit/main/documentation/modules/ROOT/pages/02-architecture.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Solution Pattern: Name Template</h1>
<h1 id="_openshift_serverless_architecture" class="sect0"><a class="anchor" href="#_openshift_serverless_architecture"></a><a class="link" href="#_openshift_serverless_architecture">OpenShift Serverless Architecture</a></h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>This document describes the fundamental concepts behind OpenShift Serverless (OSS) and Knative with architectural diagrams. In the following sections, when referring to “Knative,” we imply OpenShift Serverless, too. Except when explicitly discussing OSS, these concepts are unique to OSS and cannot be found in Knative.</p>
</div>
<div class="paragraph">
<p>Diagrams &amp; Concepts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Components diagram gives a high-level overview of Knative control plane components.</p>
</li>
<li>
<p>The Sources diagram focuses on the Adapter layer that imports external events, converts them to CloudEvents, and passes them on to sinks.</p>
</li>
<li>
<p>The Activator diagram shows the data flow for the two situations when no active application pod is running to service a request and when there are one or more replicas up to answer an incoming request.</p>
</li>
<li>
<p>The Broker diagram shows the control and data planes of the Broker.</p>
</li>
<li>
<p>The Autoscaling diagrams explain the various autoscaling parameters and how the number of active replicas is correlated to the rate of incoming requests over time.</p>
</li>
<li>
<p>The Function diagram illustrates how OSS Functions combine the build of a container image.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following diagram illustrates a sample that imports messages from a Kafka topic, wrap them into CloudEvents, and propagates them to a Knative Service via a Broker. The individual parts (Knative Eventing sources, brokers and channels, and Knative Serving’s request handling) are explained in detail in different sections of this document.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/architecture/kafka-read.png" alt="kafka read" width="100%">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_serverless_components"><a class="anchor" href="#_serverless_components"></a><a class="link" href="#_serverless_components">1. Serverless Components</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>These diagrams show the components installed in a typical OpenShift Serverless setup. The components are differentiated between control plane and data plane. You also see how the components are distributed over the fix-named namespaces “knative-serving”, “knative-eventing”, and “openshift-operators”. The diagrams are extracted from this sheet to summarise the various low-level components of a Knative installation.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/architecture/knative-serving.png" alt="knative serving" width="100%">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/architecture/knative-eventing.png" alt="knative eventing" width="100%">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/architecture/knative-operators.png" alt="knative operators" width="100%">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_serverless_operator"><a class="anchor" href="#_serverless_operator"></a><a class="link" href="#_serverless_operator">2. Serverless Operator</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>image here</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_knative_serving"><a class="anchor" href="#_knative_serving"></a><a class="link" href="#_knative_serving">3. Knative Serving</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>These diagrams visualize the flow of the various Serving components across namespace boundaries. The concepts of “Activator” or “Autoscaler” are explained below in more detail.</p>
</div>
<div class="sect2">
<h3 id="_custom_resources"><a class="anchor" href="#_custom_resources"></a><a class="link" href="#_custom_resources">3.1. Custom Resources</a></h3>
<div class="paragraph">
<p>The purpose and the relationship between the various Knative Serving components are visualized in the following diagram. In almost all use cases, the user only bothers with a Knative Service, and the other resources are created in turn. E.g., when you change the configuration part of a service, a new Revision CR is made. Likewise, if you change the traffic split piece, a new Route might be created.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/architecture/serving-overview.png" alt="serving overview" width="100%">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_revision_routing"><a class="anchor" href="#_revision_routing"></a><a class="link" href="#_revision_routing">3.2. Revision Routing</a></h3>
<div class="paragraph">
<p>The diagrams below show how an incoming request (regardless of its origin - from outside or from within the cluster) is handled for a specific Knative revision. The “Public” and “Private” Services mentioned in the diagrams are referring to Kubernetes Services that are created on behalf of a ServerlessService (SKS) CR that in turn is created for each Revision. The SKS can be either in a mode “Proxy” where all traffic is routed through the Activator in the case of scaling up from 0 but also for buffering requests in case there is not enough headroom by the scaled pods to deal with a burst of traffic. This is configured by the traffic burst capacity (TBC). If there is enough burst capacity available, the Activator goes out of the data path and the SKS is in mode “Serve”. Both modes along with their data flow for an incoming request are visualized below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/architecture/rev-routing-proxy.png" alt="rev routing proxy" width="100%">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/architecture/rev-routing-serve.png" alt="rev routing serve" width="100%">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_activator"><a class="anchor" href="#_activator"></a><a class="link" href="#_activator">3.3. Activator</a></h3>
<div class="paragraph">
<p>The activator is part of the Knative data plane and can be in two modes as illustrated below. For more details about these two modes (activator in and out of the request data path, please refer to the Knative documentation.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/architecture/activator-sequence.png" alt="activator sequence" width="100%">
</div>
</div>
<div class="paragraph">
<p>This sequence diagram explains how Knative’s activator component is intercepting the data path of an incoming HTTP request to implement the scale-to-zero functionality. The Activator is explained in detail in the Knative documentation.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/architecture/activator-overview.png" alt="activator overview" width="100%">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_autoscaler"><a class="anchor" href="#_autoscaler"></a><a class="link" href="#_autoscaler">3.4. Autoscaler</a></h3>
<div class="paragraph">
<p>The autoscaler is at the heart of Knative and offers sophisticated ways to adjust the number of applications replicas to the traffic distribution over time. An important concept here is the idea of concurrent requests (or concurrency for short), which is used favoring requests per second (RPS) in the standard setup. While the detailed algorithm of how concurrency is calculated is quite complex and beyond the scope of this document, in short: Concurrency describes the number of requests that are processed at a point in time. The benefit of this metric is that it also considers the number of processed requests and their duration, which might vary from request to request. Hence, the following diagrams are based on concurrency, but you can also configure to use RPS instead of concurrency.</p>
</div>
<div class="paragraph">
<p>The autoscaling state can be in one of two modes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Stable Mode</strong> is the initial mode that is used for a traffic distribution that is relatively smooth and doesn’t have hefty spikes.</p>
</li>
<li>
<p><strong>Panic Mode</strong> is entered if a spike of requests is detected, i.e., the increase of concurrency is more significant than a configurable threshold.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_stable_mode"><a class="anchor" href="#_stable_mode"></a><a class="link" href="#_stable_mode">3.4.1. Stable Mode</a></h4>
<div class="paragraph">
<p>The stable mode is the normal autoscaling mode when the traffic shape is not changing very quickly. It is a good compromise of service delivery but adds a bit of latency in the scaling decisions to avoid nervous up- and down-scaling.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/architecture/autoscaler-stable.png" alt="autoscaler stable" width="100%">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_panic_mode"><a class="anchor" href="#_panic_mode"></a><a class="link" href="#_panic_mode">3.4.2. Panic Mode</a></h4>
<div class="paragraph">
<p>The panic mode is entered if the actual concurrency is higher than a threshold based on the averaged concurrency. By default, the panic mode is entered when the real concurrency is more than twice as high as the averaged concurrency. The autoscaler leaves panic mode when the actual concurrency drops below this relative threshold again.</p>
</div>
<div class="paragraph">
<p>The only thing that changes in the panic mode is the length of the autoscaling windows used to calculate the average concurrency. It’s much shorter and configured as a fraction of the stable mode’s autoscaling window (default: ….). The effect of this shorter time window is that the averaged concurrency curve is much closer to the actual concurrency curve, leading to more immediate scaling decisions.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_knative_eventing"><a class="anchor" href="#_knative_eventing"></a><a class="link" href="#_knative_eventing">4. Knative Eventing</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_knative_sources"><a class="anchor" href="#_knative_sources"></a><a class="link" href="#_knative_sources">4.1. Knative Sources</a></h3>
<div class="paragraph">
<p>The sources diagram illustrates how source adapters import external events, convert them to CloudEvents, and sends them to a “sink”.</p>
</div>
</div>
<div class="sect2">
<h3 id="_connecting_sources_to_services"><a class="anchor" href="#_connecting_sources_to_services"></a><a class="link" href="#_connecting_sources_to_services">4.2. Connecting Sources to Services</a></h3>
<div class="paragraph">
<p>There are three ways to connect a source with a Knative service that differs in complexity and sophistication. These concepts do not only apply to Knative Services but generally apply to any “Sink” whose custom resource representation conforms to a certain subschema (i.e., having an url: field in its status: section which is called an “Addressable” in Knative)</p>
</div>
<div class="paragraph">
<p><strong>Direct Connection</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/architecture/source-sink.png" alt="source sink" width="100%">
</div>
</div>
<div class="paragraph">
<p><strong>Channel &amp; Subscriptions</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/architecture/channel-subs.png" alt="channel subs" width="100%">
</div>
</div>
<div class="paragraph">
<p><strong>Broker &amp; Trigger</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/architecture/broker.png" alt="broker" width="100%">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bindings"><a class="anchor" href="#_bindings"></a><a class="link" href="#_bindings">4.3. Bindings</a></h3>
<div class="paragraph">
<p>Binding is a concept in Knative that is illustrated in this diagram. A Binding is a special kind of source. However, its task is not to import and convert a CloudEvent directly from a source but connect an existing application component with a “sink”.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_knative_eventing_kafka"><a class="anchor" href="#_knative_eventing_kafka"></a><a class="link" href="#_knative_eventing_kafka">5. Knative Eventing Kafka</a></h2>
<div class="sectionbody">

</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html" class="query-params-link">1. Home page</a></span>
  <span class="next"><a href="03-solutions.html" class="query-params-link">3. See the Solutions in Action</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <img
          src="../_/img/app-services-logo.png" height="40px" alt="Cloud Native Architecture Solution Patterns"  href="https://redhat.com" ></a>
</footer><script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
